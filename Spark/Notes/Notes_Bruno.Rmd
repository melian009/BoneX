---
title: "Ecosystem services"
author: "Bruno Melati"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
  - \usepackage{amsmath}
  - \usepackage{amssymb}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Calculating ecosystem services

Each species *i* can contribute to the existence of a *j* ecosystem service. Therefore, we can map the relation species / ecosystem services as follows: 


$$ E = \mathbf{P}\vec{x}$$
 where, $\mathbf{P}$ is a matrix of $k \times s$ dimension, in which $k$ is the ecosystem services vector and $s$ is the species vector and it describes the effects of one individuals species to ecossystem service. For our pourpose, we can deal with the efect of species *i* on ecosystem services *k*. The vector $\vec{x}$ is related to the state of species (present, absent, abundance...). Each entry $P_{ij}$ depicts the effect of one individual species $j$ on each ecosystem service $i$. The $P_{ij}$ value could be the raw value or the relative value of each species $i$ contribution to the ecosystem service. For our purpose, 
 
 $$
 E_{ij} = 
 \begin{cases}
 P_{ij}, & \text{if } x_i = 1\\
 0, & \text{if } x_i = 0
 \end{cases}
 $$
Therefore, the effects of species loss could be investigated as $\Delta{E} = E^{(t_0)} - E^{(t_n)}$. 

## Running an example


```{r}
set.seed(12)
```

```{r}

#P matrix
#species state


s <- 10 #n species
state = rbinom(10, 0:1, prob = 0.5) #species state (0,1)
k <- 3 #n ecosystem services
P <- matrix(runif(k*s, 0, 1), nrow = s, ncol = k) 
P
```

```{r}
#Ecosystem services status

E <- P*state
E
#We can see the value of each ecosystem service
status <- colSums(E) 
status
```


```{r}
#Delta E

(state_t0 = rbinom(10, 0:1, prob = 0.8)) #species state (0,1)
(state_tn = rbinom(10, 0:1, prob = 0.3))#species state (0,1)
(P0 <- P*state_t0)
(Pn <- P*state_tn) 
colSums(P0)
colSums(Pn)

delta <- P0 - Pn
delta
colSums(delta)
```


# Beta distribution

To set the costs and benefits parameters we chosed a **beta distribution**. This distribution was chosed for some reasons:

  - The values are all positive. As do not exist negative cost or negative benefit, it fit to our data;
  - The values are defined on the inverval [0,1]. It could be used as the percentage of costs and benefits;
  - As the values are bounded between 0 and 1, we know the maximum value of benefits for one species, that is $B \le k_{i}$, where *k* is the degree of *i*;
  - The shape of the curve assume diffent forms as a function of the paramters. In nature we really do not know the shape of the distribuitions of costs and benefits;
  - It have a solution for ou case, which the other option of distribution (lognormal) do not.

The beta distribution have two parameters $\alpha$ abd $\beta$ and both control the shpae of the distribution. Therefore, 

$$ X \approx Beta(\alpha,\beta)$$

where, $\alpha > 0$ and  $\beta > 0$. Both parameters control de "influence" of of the shape bias. Higher $\alpha$ values, higher the concentration towards the right side of the curve. Higher $\beta$ values, higher the concentration towards the left side of the curve. 

The mean and variance of Beta depends on $\alpha$ and $\beta$ parameters, as:

$$\bar{x} = \frac{\alpha}{\alpha + \beta}$$
$$\mathrm{Var}(X) = \frac{\alpha \beta} {(\alpha + \beta)^2 (\alpha + \beta + 1)}$$

and $$E[X] = \frac{\alpha}{\alpha + \beta}$$

```{r}
 # Define the function to integrate
    func_to_integrate <- function(x, alpha, beta) {
      x * dbeta(x, shape1 = alpha, shape2 = beta)
    }

    # Set your alpha and beta values
    alpha_val <- 2
    beta_val <- 3

    # Perform the numerical integration
    integration_result <- integrate(func_to_integrate, lower = 0, upper = 1, alpha = alpha_val, beta = beta_val)

    # The expected value is the 'value' element of the result
    expected_value <- integration_result$value
    print(expected_value)

```









