---
title: "Ecosystem services"
author: "Bruno Melati"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
  - \usepackage{amsmath}
  - \usepackage{amssymb}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Calculating ecosystem services

Each species *i* can contribute to the existence of a *j* ecosystem service. Therefore, we can map the relation species / ecosystem services as follows: 


$$ E = \mathbf{P}\vec{x}$$
 where, $\mathbf{P}$ is a matrix of $k \times s$ dimension, in which $k$ is the ecosystem services vector and $s$ is the species vector. The vector $\vec{x}$ is related to the state of species (present, absent, abundance...). Each entry $P_{ij}$ depicts the effect of one individual species $j$ on each ecosystem service $i$. The $P_{ij}$ value could be the raw value or the relative value of each species $i$ contribution to the ecosystem service. For our purpose, 
 
 $$
 E_{ij} = 
 \begin{cases}
 P_{ij}, & \text{if } x_i = 1\\
 0, & \text{if } x_i = 0
 \end{cases}
 $$
Therefore, the effects of species loss could be investigated as $\Delta{E} = E^{(t_0)} - E^{(t_n)}$. 

## Running an example


```{r}
set.seed(12)
```

```{r}

#P matrix
#species state


s <- 10 #n species
state = rbinom(10, 0:1, prob = 0.5) #species state (0,1)
k <- 3 #n ecosystem services
P <- matrix(runif(k*s, 0, 1), nrow = s, ncol = k) 
P
```

```{r}
#Ecosystem services status

E <- P*state
E
#We can see the value of each ecosystem service
status <- colSums(E) 
status
```


```{r}
#Delta E

(state_t0 = rbinom(10, 0:1, prob = 0.8)) #species state (0,1)
(state_tn = rbinom(10, 0:1, prob = 0.3))#species state (0,1)
(P0 <- P*state_t0)
(Pn <- P*state_tn) 
colSums(P0)
colSums(Pn)

delta <- P0 - Pn
delta
colSums(delta)
```

